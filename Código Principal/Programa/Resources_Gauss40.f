      SUBROUTINE INTE(XP,YP,X1,Y1,X2,Y2,H1,H2,G1,G2,HG1,HG2,GG1,GG2)  
      IMPLICIT NONE  
	COMMON NE,NP,L,LEC,IMP,NPI,NT
	INTEGER I,NE,NP,L,LEC,IMP,NPI,NT
	REAL*8 GI(40),OME(40),AX,X1,X2,BX,AY,Y1,Y2,BY,COMP
	REAL*8 H1,H2,G1,G2,PI2,XCO(40)
	REAL*8 HG1,HG2,GG1,GG2
	REAL*8 YCO(40),RA,XP,YP,AUX,CJAC,GX,GY,HX,HY,SEN,COS
	REAL*8 H,G
	REAL*8 HGAR,GGAR



	GI(1)=0.998237709710559340
      GI(2)=-GI(1)
      GI(3)=0.990726238699457038
      GI(4)=-GI(3)
      GI(5)=0.977259949983774336
      GI(6)=-GI(5)
      GI(7)=0.957916819213791734
      GI(8)=-GI(7)
      GI(9)=0.932812808278676532 
      GI(10)=-GI(9)
      GI(11)=0.902098806968874330 
      GI(12)=-GI(11)
      GI(13)=0.865959503212259528
      GI(14)=-GI(13)
      GI(15)=0.824612230833311726
      GI(16)=-GI(15)
      GI(17)=0.778305651426519424
      GI(18)=-GI(17)
      GI(19)=0.727318255189927122 
      GI(20)=-GI(19)
	GI(21)=0.671956684614179620
      GI(22)=-GI(21)
      GI(23)=0.612553889667980218
      GI(24)=-GI(23)
      GI(25)=0.549467125095128216
      GI(26)=-GI(25)
      GI(27)=0.483075801686178714
      GI(28)=-GI(27)
      GI(29)=0.413779204371605012
      GI(30)=-GI(29)
      GI(31)=0.341994090825758510 
      GI(32)=-GI(31)
      GI(33)=0.26815218500725378
      GI(34)=-GI(33)
      GI(35)=0.19269758070137116
      GI(36)=-GI(35)
      GI(37)=0.11608407067525524
      GI(38)=-GI(37)
      GI(39)=0.03877241750605082 
      GI(40)=-GI(39)

*
*      PESOS DE GAUSS

      OME(1)=0.0045212770985332
      OME(2)=OME(1)
      OME(3)=0.0104982845311528 
      OME(4)=OME(3)
      OME(5)=0.0164210583819079 
      OME(6)=OME(5)
      OME(7)=0.0222458491941670
      OME(8)=OME(7)
      OME(9)=0.0279370069800234
      OME(10)=OME(9)
      OME(11)=0.0334601952825478 
      OME(12)=OME(11)
      OME(13)=0.0387821679744720
      OME(14)=OME(13)
      OME(15)=0.0438709081856733
      OME(16)=OME(15)
      OME(17)=0.0486958076350722
      OME(18)=OME(17)
      OME(19)=0.0532278469839368
      OME(20)=OME(19)
      OME(21)=0.0574397690993916 
      OME(22)=OME(21)
      OME(23)=0.0613062424929289
      OME(24)=OME(23)
      OME(25)=0.0648040134566010
      OME(26)=OME(25)
      OME(27)=0.0679120458152339
      OME(28)=OME(27)
      OME(29)=0.0706116473912868
      OME(30)=OME(29)
      OME(31)=0.0728865823958041 
      OME(32)=OME(31)
      OME(33)=0.0747231690579683
      OME(34)=OME(33)
      OME(35)=0.0761103619006262
      OME(36)=OME(35)
      OME(37)=0.0770398181642480 
      OME(38)=OME(37)
      OME(39)=0.0775059479784248
      OME(40)=OME(39)


      AX=(X2-X1)/2				!TAMANHO X DA METADE DO ELEMENTO
      BX=(X2+X1)/2				!VALOR DA COORDENADA X DA METADE DO ELEMENTO
      AY=(Y2-Y1)/2				!TAMANHO Y DA METADE DO ELEMENTO
      BY=(Y1+Y2)/2				!VALOR DA COORDENADA Y DA METADE DO ELEMENTO
	COMP=2*DSQRT(AX**2+AY**2)	!COMPRIMENTO DO ELEMENTO
	CJAC=COMP/2					!METADE DO COMPRIMENTO DO ELEMENTO (COMP. JACOBIANA)
      SEN=(X1-X2)/COMP			!SENO DO ELEMENTO
      COS=(Y2-Y1)/COMP			! COSSENO DO ELEMENTO
		     
      H1=0
      H2=0
      G1=0
      G2=0
	HG1=0
	HG2=0
	GG1=0
	GG2=0

	PI2=6.28318
      
      DO 40 I=1,40
		!VARIAVEIS DE APOIO
		XCO(I)=AX*GI(I)+BX !VALOR DA COORDENADA DO PTO CENTRAL DO ELEMENTO +- METADE DO COMPRIMENTO PONDERADO PELO PONTO DE GAUSS
		YCO(I)=AY*GI(I)+BY
		RA=DSQRT((XCO(I)-XP)**2+(YCO(I)-YP)**2) ! RAIO = SQRT(RI²)
		AUX=(XCO(I)-XP)*COS+(YCO(I)-YP)*SEN ! MULTIPLICAÇÃO RI*NI = [X(KSI)-X(J)]*N1+[Y(KSI)-Y(J)]*N2 = [X(KSI)-X(J)]*COS+[Y(KSI)-Y(J)]*SEN
		
		!CALCULO DAS MATRIZES H E G
		H=-AUX*OME(I)*CJAC/(PI2*RA**2) ! CALCULO MATRIZ H = (-1/2PI)*(1/R)*(DR/DN)*NI = (-1/2PI)*(1/R)*R,I*NI = (-1/2PI)*(1/R)*(RI/R)*NI = (-1/2PI)*(1/R²)*(RI*NI)
		G=DLOG(1/RA)*OME(I)*CJAC/PI2   ! CALCULO MATRIZ G = LN(1/R)/2PI
		H1=H1-(GI(I)-1)*H/2 !H COM PHI1     !VERIFICAR
		H2=H2+(GI(I)+1)*H/2 !H COM PHI2     !VERIFICAR
		G1=G1-(GI(I)-1)*G/2 !G COM PHI1     !VERIFICAR
		G2=G2+(GI(I)+1)*G/2 !G COM PHI2     !VERIFICAR - É POR CAUSA DO ELEMENTO SER LINEAR ?

		!CALCULO DAS MATRIZES HG E GG
		GGAR=RA*RA*(1.-DLOG(RA))*OME(I)*CJAC/(4*PI2) !G*=(R²/8PI)*(1-LN(R))
		HGAR=(0.5-DLOG(RA))*OME(I)*AUX*CJAC/(2*PI2)  !G,I*NI=(1/4PI)*[0.5-LN(R)]*AUX
		HG1=HG1-(GI(I)-1)*HGAR/2
		HG2=HG2+(GI(I)+1)*HGAR/2
		GG1=GG1-(GI(I)-1)*GGAR/2
		GG2=GG2+(GI(I)+1)*GGAR/2


40	CONTINUE


	RETURN
      END

      SUBROUTINE INLO(X1,Y1,X2,Y2,G1,G2)
	IMPLICIT NONE
	REAL*8 SEP,G1,X1,X2,Y1,Y2,G2

	SEP=DSQRT((X2-X1)**2+(Y2-Y1)**2) !CALCULO DO RAIO DO ELEMENTO
	G1=SEP*(1.5-DLOG(SEP))/(2*6.28318) !G COM PHI1     !VERIFICAR
      G2=SEP*(0.5-DLOG(SEP))/(2*6.28318) !G COM PHI2     !VERIFICAR - É POR CAUSA DO ELEMENTO SER LINEAR ?
      CONTINUE
      RETURN
      END
C
C

	SUBROUTINE GALERK1(XP,YP,X1,Y1,X2,Y2,HG1,HG2,GG1,GG2)  
	COMMON NE,NP,L,LEC,IMP,NPI,NT
	REAL*8 XCO(40),YCO(40),GI(40),OME(40)
	REAL*8 HG1,HG2,GG1,GG2,AX,X1,X2,BX,AY,Y1,Y2,BY,COMP
	REAL*8 RA,XP,YP,AUX,H,G,CJAC,GX,GY,HX,HY,SEN,COSS
	REAL*8 HGAR,GGAR

	GI(1)=0.998237709710559340
      GI(2)=-GI(1)
      GI(3)=0.990726238699457038
      GI(4)=-GI(3)
      GI(5)=0.977259949983774336
      GI(6)=-GI(5)
      GI(7)=0.957916819213791734
      GI(8)=-GI(7)
      GI(9)=0.932812808278676532 
      GI(10)=-GI(9)
      GI(11)=0.902098806968874330 
      GI(12)=-GI(11)
      GI(13)=0.865959503212259528
      GI(14)=-GI(13)
      GI(15)=0.824612230833311726
      GI(16)=-GI(15)
      GI(17)=0.778305651426519424
      GI(18)=-GI(17)
      GI(19)=0.727318255189927122 
      GI(20)=-GI(19)
	GI(21)=0.671956684614179620
      GI(22)=-GI(21)
      GI(23)=0.612553889667980218
      GI(24)=-GI(23)
      GI(25)=0.549467125095128216
      GI(26)=-GI(25)
      GI(27)=0.483075801686178714
      GI(28)=-GI(27)
      GI(29)=0.413779204371605012
      GI(30)=-GI(29)
      GI(31)=0.341994090825758510 
      GI(32)=-GI(31)
      GI(33)=0.26815218500725378
      GI(34)=-GI(33)
      GI(35)=0.19269758070137116
      GI(36)=-GI(35)
      GI(37)=0.11608407067525524
      GI(38)=-GI(37)
      GI(39)=0.03877241750605082 
      GI(40)=-GI(39)


      !PESOS DE GAUSS

      OME(1)=0.0045212770985332
      OME(2)=OME(1)
      OME(3)=0.0104982845311528 
      OME(4)=OME(3)
      OME(5)=0.0164210583819079 
      OME(6)=OME(5)
      OME(7)=0.0222458491941670
      OME(8)=OME(7)
      OME(9)=0.0279370069800234
      OME(10)=OME(9)
      OME(11)=0.0334601952825478 
      OME(12)=OME(11)
      OME(13)=0.0387821679744720
      OME(14)=OME(13)
      OME(15)=0.0438709081856733
      OME(16)=OME(15)
      OME(17)=0.0486958076350722
      OME(18)=OME(17)
      OME(19)=0.0532278469839368
      OME(20)=OME(19)
      OME(21)=0.0574397690993916 
      OME(22)=OME(21)
      OME(23)=0.0613062424929289
      OME(24)=OME(23)
      OME(25)=0.0648040134566010
      OME(26)=OME(25)
      OME(27)=0.0679120458152339
      OME(28)=OME(27)
      OME(29)=0.0706116473912868
      OME(30)=OME(29)
      OME(31)=0.0728865823958041 
      OME(32)=OME(31)
      OME(33)=0.0747231690579683
      OME(34)=OME(33)
      OME(35)=0.0761103619006262
      OME(36)=OME(35)
      OME(37)=0.0770398181642480 
      OME(38)=OME(37)
      OME(39)=0.0775059479784248
      OME(40)=OME(39)



      AX=(X2-X1)/2				!TAMANHO X DA METADE DO ELEMENTO
      BX=(X2+X1)/2				!VALOR DA COORDENADA X DA METADE DO ELEMENTO
      AY=(Y2-Y1)/2				!TAMANHO Y DA METADE DO ELEMENTO
      BY=(Y1+Y2)/2				!VALOR DA COORDENADA Y DA METADE DO ELEMENTO
	COMP=2*DSQRT(AX**2+AY**2)	!COMPRIMENTO DO ELEMENTO
	CJAC=COMP/2					!METADE DO COMPRIMENTO DO ELEMENTO (COMP. JACOBIANA)
      SEN=(X1-X2)/COMP			!SENO DO ELEMENTO
      COS=(Y2-Y1)/COMP			! COSSENO DO ELEMENTO
            
	HG1=0
	HG2=0
	GG1=0
	GG2=0
	PI2=6.28318
      
      DO 1400 I=1,40
		XCO(I)=AX*GI(I)+BX
		YCO(I)=AY*GI(I)+BY
		RA=SQRT((XCO(I)-XP)**2+(YCO(I)-YP)**2)
		AUX=(XCO(I)-XP)*COS+(YCO(I)-YP)*SEN
		GGAR=RA*RA*(1.-DLOG(RA))*OME(I)*CJAC/(4*PI2) !G*=(R²/8PI)*(1-LN(R))
		HGAR=(0.5-DLOG(RA))*OME(I)*AUX*CJAC/(2*PI2)  !G,I*NI=(1/4PI)*[0.5-LN(R)]*AUX
		HG1=HG1-(GI(I)-1)*HGAR/2
		HG2=HG2+(GI(I)+1)*HGAR/2
		GG1=GG1-(GI(I)-1)*GGAR/2
		GG2=GG2+(GI(I)+1)*GGAR/2
1400  CONTINUE
      RETURN
      END
C
C
	SUBROUTINE GALERK2(X1,Y1,X2,Y2,GG1,GG2)
C
C	DETERMINAÇÃO DOS COEFICIENTES DA INTEGRAÇÃO DE G* DIRETA NO PRÓPRIO ELEMENTO, PONTO CSI NOS EXTREMOS
C
	REAL*8 SEP,GG1,GG2,X1,X2,Y1,Y2

      SEP=SQRT((X2-X1)**2+(Y2-Y1)**2)
    	GG1=(SEP**3)*(19.0-12*DLOG(SEP))/(1152*3.1415926) !ENCONTRAR ORIGEM DESSA INTEGRAL ???
      GG2=(SEP**3)*(5.0-4*DLOG(SEP))/(128*3.1415926)
      CONTINUE
      RETURN
      END


C
C
      SUBROUTINE INTE1(XP,YP,X1,Y1,X2,Y2,GG)
	IMPLICIT NONE
	COMMON NE,NP,L,LEC,IMP,NPI,NT
	INTEGER IMP,I,NE,NP,L,LEC,NPI,NT
	REAL*8 GI(40),OME(40),GG,AX,X2,X1,BX,AY,Y2,YP,AUX,COS
	REAL*8 Y1,BY,COMP,CJAC,PI2,XCO(40),YCO(40),RA,XP,SEN   
 

	 GI(1)=0.998237709710559340
       GI(2)=-GI(1)
       GI(3)=0.990726238699457038
       GI(4)=-GI(3)
       GI(5)=0.977259949983774336
       GI(6)=-GI(5)
       GI(7)=0.957916819213791734
       GI(8)=-GI(7)
       GI(9)=0.932812808278676532 
       GI(10)=-GI(9)
       GI(11)=0.902098806968874330 
       GI(12)=-GI(11)
       GI(13)=0.865959503212259528
       GI(14)=-GI(13)
       GI(15)=0.824612230833311726
       GI(16)=-GI(15)
       GI(17)=0.778305651426519424
       GI(18)=-GI(17)
       GI(19)=0.727318255189927122 
       GI(20)=-GI(19)
	 GI(21)=0.671956684614179620
       GI(22)=-GI(21)
       GI(23)=0.612553889667980218
       GI(24)=-GI(23)
       GI(25)=0.549467125095128216
       GI(26)=-GI(25)
       GI(27)=0.483075801686178714
       GI(28)=-GI(27)
       GI(29)=0.413779204371605012
       GI(30)=-GI(29)
       GI(31)=0.341994090825758510 
       GI(32)=-GI(31)
       GI(33)=0.26815218500725378
       GI(34)=-GI(33)
       GI(35)=0.19269758070137116
       GI(36)=-GI(35)
       GI(37)=0.11608407067525524
       GI(38)=-GI(37)
       GI(39)=0.03877241750605082 
       GI(40)=-GI(39)

*
*      PESOS DE GAUSS
*
       OME(1)=0.0045212770985332
       OME(2)=OME(1)
       OME(3)=0.0104982845311528 
       OME(4)=OME(3)
       OME(5)=0.0164210583819079 
       OME(6)=OME(5)
       OME(7)=0.0222458491941670
       OME(8)=OME(7)
       OME(9)=0.0279370069800234
       OME(10)=OME(9)
       OME(11)=0.0334601952825478 
       OME(12)=OME(11)
       OME(13)=0.0387821679744720
       OME(14)=OME(13)
       OME(15)=0.0438709081856733
       OME(16)=OME(15)
       OME(17)=0.0486958076350722
       OME(18)=OME(17)
       OME(19)=0.0532278469839368
       OME(20)=OME(19)
       OME(21)=0.0574397690993916 
       OME(22)=OME(21)
       OME(23)=0.0613062424929289
       OME(24)=OME(23)
       OME(25)=0.0648040134566010
       OME(26)=OME(25)
       OME(27)=0.0679120458152339
       OME(28)=OME(27)
       OME(29)=0.0706116473912868
       OME(30)=OME(29)
       OME(31)=0.0728865823958041 
       OME(32)=OME(31)
       OME(33)=0.0747231690579683
       OME(34)=OME(33)
       OME(35)=0.0761103619006262
       OME(36)=OME(35)
       OME(37)=0.0770398181642480 
       OME(38)=OME(37)
       OME(39)=0.0775059479784248
       OME(40)=OME(39)


	GG=0.
      
      AX=(X2-X1)/2
      BX=(X2+X1)/2
      AY=(Y2-Y1)/2
      BY=(Y1+Y2)/2
	COMP=2*DSQRT(AX**2+AY**2)
	CJAC=COMP/2
      SEN=(X1-X2)/COMP
      COS=(Y2-Y1)/COMP
      
      PI2=6.28318
      
      DO 40 I=1,40
      XCO(I)=AX*GI(I)+BX
      YCO(I)=AY*GI(I)+BY
      RA=DSQRT((XCO(I)-XP)**2+(YCO(I)-YP)**2)
	AUX=(XCO(I)-XP)*COS+(YCO(I)-YP)*SEN !RI*NI
C	GG=GG+(RA**2)*(4*DLOG(RA)-1.)*AUX*OME(I)*CJAC/16+
C	*(DEXP(-RA)*(2.-RA))*AUX*OME(I)*CJAC															
C	GG=GG+RA*(DLOG(RA)+DEXP(-RA))*AUX*OME(I)*CJAC
C     RADIAL SIMPLES

C	GG=GG+RA*AUX*OME(I)*CJAC/3
C
C	FUNÇÃO LOG
	GG=GG+(RA**2)*(4*DLOG(RA)-1.)*AUX*OME(I)*CJAC/16  !(R²/16)*[4*LN(R)-1]*(RI*NI)
C      GG=GG+RA*AUX*OME(I)*CJAC/3+0.5*AUX*OME(I)*CJAC
C	GG=GG+(DEXP(-RA)*(2.-RA))*AUX*OME(I)*CJAC
C	WRITE(IMP,*)I,'VALOR DE GG NA INTE1=',GG
  40   CONTINUE
      RETURN
      END
C
C
C
 !     SUBROUTINE INLO1(X1,Y1,X2,Y2,GG)
	!IMPLICIT NONE
	!COMMON NE,NP,L,LEC,IMP,NPI,NT
	!INTEGER IMP,NE,NP,L,LEC,NPI,NT
	!REAL*8 AX,X1,X2,AY,Y1,Y2,COMP,AUX,RA,GG,SEN,COS
 !
	!AX=(X2-X1)/2
 !     AY=(Y2-Y1)/2
	!COMP=2*DSQRT(AX**2+AY**2)
	!SEN=(X1-X2)/COMP
 !     COS=(Y2-Y1)/COMP
 ! 	AUX=(X2-X1)*COS+(Y2-Y1)*SEN
 !     RA=DSQRT((X2-X1)**2+(Y2-Y1)**2)
 !     GG=AUX/(2*6.28318)
 ! 
 !      WRITE(IMP,*)'FINALMENTE ENTREI NA INLO1'
	!WRITE(IMP,*)'GG=',GG
 !     RETURN
 !     END
C
C
      SUBROUTINE INLO1(XP,YP,X1,Y1,X2,Y2,B1,B2)
	IMPLICIT NONE
	COMMON NE,NP,L,LEC,IMP,NPI,NT
	INTEGER IMP,NE,NP,L,LEC,NPI,NT
	REAL*8 X1,X2,Y1,Y2,XP,YP,SEP
	REAL*8 B1,B2,WROP1,WROP2,AUXIL
      SEP=SQRT((X2-X1)**2+(Y2-Y1)**2)
	
C	WRITE(IMP,*)'X1=',X1,'X2=',X2
C 	WRITE(IMP,*)'Y1=',Y1,'Y2=',Y2
C	WRITE(IMP,*)'XP=',XP,'YP=',YP


      WROP1=SQRT((XP-X1)**2+(YP-Y1)**2)
   	WROP2=SQRT((XP-X2)**2+(YP-Y2)**2)

C	WRITE(IMP,*)'WROP1=',WROP1
C	WRITE(IMP,*)'WROP2=',WROP2

	IF(WROP1.GT.WROP2)GO TO 11
	AUXIL=WROP1
	WROP1=WROP2
	WROP2=AUXIL
	B1=-(WROP1/(SEP*6.28318))*(WROP1*DLOG(WROP1)    ! DE ONDE VEIO ESSA EQUAÇÃO DE INTEGRAÇÃO.
     *+WROP2*DLOG(WROP2)-SEP)-(1.0/(SEP*2*6.28318))  
     **((WROP2**2)*DLOG(WROP2)-WROP1**2*DLOG(WROP1)   ! O QUE É B1 E B2 ?
     *+SEP*SEP/2-SEP*WROP2)   
     	B2=-(WROP2/(SEP*6.28318))*(WROP1*DLOG(WROP1)
     *+WROP2*DLOG(WROP2)-SEP)+(1.0/(SEP*2*6.28318))
     **((WROP2**2)*DLOG(WROP2)-WROP1**2*DLOG(WROP1)
     *+SEP*SEP/2-SEP*WROP2)
11    CONTINUE	
 	B2=-(WROP1/(SEP*6.28318))*(WROP1*DLOG(WROP1)
     *+WROP2*DLOG(WROP2)-SEP)-(1.0/(SEP*2*6.28318))
     **((WROP2**2)*DLOG(WROP2)-WROP1**2*DLOG(WROP1)
     *+SEP*SEP/2-SEP*WROP2)
     	B1=-(WROP2/(SEP*6.28318))*(WROP1*DLOG(WROP1)
     *+WROP2*DLOG(WROP2)-SEP)+(1.0/(SEP*2*6.28318))
     **((WROP2**2)*DLOG(WROP2)-WROP1**2*DLOG(WROP1)
     *+SEP*SEP/2-SEP*WROP2)
  30  CONTINUE
	RETURN
      END

      SUBROUTINE INTER(FI,DFI,KODE,NX)
	IMPLICIT NONE
	COMMON NE,NP,L,LEC,IMP,NPI,NT
	INTEGER NX,KODE(NX),I,NP,K,L,M,LOCC(NX),L1,L2,NOP(NX,3)
	INTEGER J,NE,NT,LEC,IMP,NPI
	REAL*8 CH,FI(NX),DFI(NX),SOL(NX),DSOLX(NX),DSOLY(NX)
	REAL*8 XXC(NX),YYC(NX),X(NX),Y(NX),A1,A2,B1,B2,DX1,DX2
	REAL*8 DY1,DY2,EX1,EX2,EY1,EY2,DRUMX,DRUMY,ZOG1,ZOG2
	REAL*8 HCSI(NX,NX),XX(NX),YY(NX),REX(NX,NX)
	REAL*8 DOMA(NX,NX),DOMB(NX,NX),GCSI(NX,NX),C1
	REAL*8 A(NX,NX),B(NX,NX),DOMT(NX),CB(NX)

      DO 20 I=1,NP
      IF (KODE(I)) 20,20,10 ! FLUXO (1)-10 E POTENCIAL (0)-20
 10   CH=FI(I) !É FLUXO (DFI DEVOLVE O POTENCIAL CALCULADO PARA O FI)
      FI(I)=DFI(I)
      DFI(I)=CH
 20   CONTINUE !É POTENCIAL (ESTÁ CORRETO OS PONTOS DO CONTORNO) MAS, DFI DEVOLVE O POTENCIAL CALCULADO PARA OS PONTOS INTERNOS 
      DO 21 I=NP+1,NT                                                                     !(POIS Q=0 PTS INTERNOS)
	CH=FI(I)
      FI(I)=DFI(I)
      DFI(I)=CH
 21   CONTINUE
      
	DO 22 I=1,NT    !IMPRESSÃO POTENCIAL
	WRITE(IMP,*)'FI=',FI(I)
22    CONTINUE
      RETURN
      END
C
      
      
      !ROTINA DE INVERSÃO DA MATRIZ (F-¹) 
	SUBROUTINE MATRIZINVERSA(A,N) 
	IMPLICIT NONE
	INTEGER IMP,K,N,J,I,JI,KI
	REAL*8 LO(2000),MO(2000),BIGA,A(2000,2000),HOLD

C     
C      INVERTE A MATRIZ ATRAVES DO METODO PADRAO DE GAUSS-JORDAN
C      O DETERMINANTE TAMBEM E CALCULADO. UM DETERMINANTE NULO INDICA QUE A 
C      MATRIZ E SINGULAR.
C
C      A - MATRIZ DE ENTRADA, DESTRUIDA NA OPERACAO E SUBSTITUIDA PELA
C          INVERSA RESULTANTE
C      N - ORDEM DA MATRIZ A
C      LO - VETOR DE TRABALHO
C      MO - VETOR DE TRABALHO
C     
      IMP=6
C
C
C      PROCURA DO MAIOR ELEMENTO
C
       DO 100 K=1,N
         LO(K)=K
         MO(K)=K
         BIGA=A(K,K)
         DO 10 J=K,N
         DO 10 I=K,N
           IF(DABS(BIGA).GE.DABS(A(I,J))) GO TO 10
           BIGA=A(I,J)
           LO(K)=I
           MO(K)=J
10       CONTINUE
C
C      MUDANCA DE LINHAS
C
         J=LO(K)
         IF(J.LE.K) GO TO 30
         DO 20 I=1,N
           HOLD=-A(K,I)
C           JI=KI-K+J
           A(K,I)=A(J,I)
           A(J,I)=HOLD
20       CONTINUE
C
C      MUDANCA DE COLUNAS
C
30       I=MO(K)
         IF(I.LE.K) GO TO 50
         DO 40 J=1,N
           HOLD=-A(J,K)
           A(J,K)=A(J,I)
           A(J,I)=HOLD
40       CONTINUE
C
C      DIVIDE COLUNA POR PIVOT NEGATIVO ( VALOR DOS ELEMENTOS DO PIVOT ESTAO
C      CONTABILIZADOS EM BIGA)
C
50       IF((DABS(BIGA)).GT.0)  GO TO 60
           WRITE (IMP,160) K
           STOP
60       DO 70 I=1,N
           IF(I.EQ.K) GO TO 70
           A(I,K)=A(I,K)/(-BIGA)
70       CONTINUE
C
C      REDUCAO DA MATRIZ
C
         DO 80 I=1,N
           HOLD=A(I,K)
           DO 80 J=1,N
             IF(I.EQ.K) GO TO 80
             IF(J.EQ.K) GO TO 80
             A(I,J)=HOLD*A(K,J)+A(I,J)
80       CONTINUE
C
C      DIVIDE A LINHA PELO PIVOT
C
         DO 90 J=1,N
           IF(J.EQ.K) GO TO 90
           A(K,J)=A(K,J)/BIGA
90       CONTINUE
C
C      SUBSTITUI O PIVOT PELO RECIPROCO
C
         A(K,K)=1.0/BIGA
100    CONTINUE
C
C      MUDANCA FINAL DE LINHAS E COLUNAS
C
       K=N-1
110    CONTINUE
       I=LO(K)
       IF(I.LE.K) GO TO 130
       DO 120 J=1,N
         HOLD=A(J,K)
         A(J,K)=-A(J,I)
         A(J,I)=HOLD
120    CONTINUE
130    J=MO(K)
       IF(J.LE.K) GO TO 150
       DO 140 I=1,N
         HOLD=A(K,I)
         A(K,I)=-A(J,I)
         A(J,I)=HOLD
140    CONTINUE
150    K=K-1
       IF(K.GT.0)GO TO 110
       RETURN
160    FORMAT(/,20X,'DURANTE A OPERACAO DE INVERSAO DA MATRIZ',/,20X,
     1'DETERMINANTE NULO FOI DETECTADO.  O PROCESSAMENTO FOI',/,20X,
     1'INTERROMPIDO  O NUMERO DA LINHA OU COLUNA FOI :',I4,/,20X,
     1'DENTRO DA ROTINA MATRIZINVERSA - INVERSAO DE MATRIZ')
      END
  
      
